<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nueva reunión – Conejeros Solutions</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <style>
    * { box-sizing:border-box; margin:0; padding:0; }
    html, body { height:100%; }
    body {
      font-family: Inter, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:#f3f5fb;
      color:#1f2933;
      -webkit-font-smoothing:antialiased;
      text-rendering:optimizeLegibility;
    }

    .page {
      min-height:100vh;
      display:flex;
      justify-content:center;
      padding:40px 16px;
    }

    .card {
      max-width:980px;
      width:100%;
      background:#fff;
      border-radius:24px;
      box-shadow:0 18px 55px rgba(15,23,42,0.18);
      display:grid;
      grid-template-columns: minmax(0, 320px) minmax(0, 1fr);
      overflow:hidden;
    }

    /* Lado izquierdo: info del evento */
    .left {
      padding:24px 26px;
      border-right:1px solid #e5e7f0;
      display:flex;
      flex-direction:column;
      gap:18px;
    }
    .host {
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:.12em;
      color:#6b7280;
      font-weight:600;
    }
    .title {
      font-size:22px;
      font-weight:700;
      color:#111827;
      margin-top:4px;
    }
    .meta {
      display:flex;
      align-items:center;
      gap:8px;
      font-size:14px;
      color:#4b5563;
    }
    .meta span.icon-circle {
      width:24px;
      height:24px;
      border-radius:999px;
      background:#eef2ff;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:13px;
      color:#4f46e5;
    }
    .desc {
      font-size:14px;
      color:#6b7280;
      line-height:1.5;
    }
    .left-footer {
      margin-top:auto;
      font-size:12px;
      color:#9ca3af;
    }

    /* Lado derecho: calendario + horarios */
    .right {
      padding:24px 26px 22px;
      display:flex;
      flex-direction:column;
      gap:18px;
    }
    .right-header {
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
    }
    .right-header h2 {
      font-size:16px;
      font-weight:600;
      color:#111827;
      margin-bottom:10px;
    }
    .tz-label {
      font-size:12px;
      color:#6b7280;
      text-align:right;
      white-space:nowrap;
      padding-top:2px;
    }

    /* Campo nombre */
    .field {
      display:flex;
      flex-direction:column;
      gap:6px;
      margin-top:4px;
      max-width:360px;
    }
    .field label{
      font-size:12px;
      color:#6b7280;
      font-weight:600;
    }
    .field input{
      width:100%;
      border:1px solid #e5e7f0;
      border-radius:12px;
      padding:10px 12px;
      font-size:14px;
      outline:none;
    }
    .field input:focus{
      border-color:#c7ccf5;
      box-shadow:0 0 0 4px rgba(79,70,229,0.12);
    }

    .calendar-layout {
      display:grid;
      grid-template-columns:minmax(0, 1.15fr) minmax(0, 0.9fr);
      gap:24px;
    }

    /* Calendar */
    .calendar {
      border:1px solid #e5e7f0;
      border-radius:16px;
      padding:12px 12px 14px;
    }
    .cal-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:8px;
    }
    .month-label {
      font-size:14px;
      font-weight:600;
      color:#111827;
    }
    .nav-btn {
      border:none;
      background:#f3f4ff;
      border-radius:999px;
      width:26px;
      height:26px;
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      font-size:14px;
      color:#4f46e5;
    }
    .nav-btn:disabled {
      opacity:.4;
      cursor:default;
    }

    .weekday-row, .days-grid {
      display:grid;
      grid-template-columns:repeat(7,minmax(0,1fr));
      gap:2px;
    }
    .weekday {
      text-align:center;
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.06em;
      color:#9ca3af;
      padding:4px 0 6px;
    }

    .day {
      position:relative;
      border:none;
      background:transparent;
      border-radius:999px;
      padding:6px 0;
      font-size:13px;
      cursor:pointer;
      color:#111827;
      transition:background .12s ease, color .12s ease, box-shadow .12s ease, transform .08s ease;
    }
    .day span {
      position:relative;
      z-index:1;
    }
    .day::before {
      content:"";
      position:absolute;
      inset:0;
      border-radius:999px;
      background:transparent;
      transition:background .12s ease, box-shadow .12s ease;
    }
    .day:hover::before {
      background:#eef2ff;
    }
    .day.today::before {
      background:#eef2ff;
    }
    .day.disabled {
      cursor:default;
      color:#d1d5db;
    }
    .day.disabled:hover::before {
      background:transparent;
    }
    .day.selected {
      color:#fff;
      transform:translateY(-1px);
    }
    .day.selected::before {
      background:linear-gradient(135deg,#4f46e5,#6366f1);
      box-shadow:0 6px 20px rgba(79,70,229,0.45);
    }

    /* Slots */
    .slots-card {
      border:1px solid #e5e7f0;
      border-radius:16px;
      padding:12px 12px 14px;
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height:220px;
    }
    .slots-title {
      font-size:13px;
      font-weight:500;
      color:#111827;
      margin-bottom:4px;
    }
    .selected-date-label {
      font-size:12px;
      color:#6b7280;
      margin-bottom:2px;
    }
    .slot-list {
      display:flex;
      flex-direction:column;
      gap:8px;
      margin-top:4px;
    }
    .slot-btn {
      border-radius:999px;
      border:1px solid #d4d7e5;
      padding:8px 10px;
      font-size:14px;
      text-align:center;
      background:#fff;
      cursor:pointer;
      color:#111827;
      transition:background .12s ease, color .12s ease, border-color .12s ease, box-shadow .12s ease, transform .08s ease;
    }
    .slot-btn:hover {
      background:#eef2ff;
      border-color:#c7ccf5;
    }
    .slot-btn.selected {
      background:linear-gradient(135deg,#4f46e5,#6366f1);
      color:#fff;
      border-color:transparent;
      box-shadow:0 10px 24px rgba(79,70,229,0.55);
      transform:translateY(-1px);
    }
    .slot-btn:disabled {
      cursor:default;
      color:#c4c6d5;
      background:#f3f4f6;
      border-color:#e5e7f0;
      box-shadow:none;
    }

    .confirm-area {
      margin-top:auto;
      padding-top:8px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .btn-primary {
      border:none;
      border-radius:999px;
      padding:10px 18px;
      font-size:14px;
      font-weight:600;
      background:linear-gradient(135deg,#111827,#1f2937);
      color:#fff;
      cursor:pointer;
      align-self:flex-start;
      display:inline-flex;
      align-items:center;
      gap:8px;
      transition:background .12s ease, transform .08s ease, box-shadow .12s ease;
    }
    .btn-primary span {
      font-size:16px;
    }
    .btn-primary:hover {
      transform:translateY(-1px);
      box-shadow:0 12px 26px rgba(15,23,42,0.35);
    }
    .btn-primary:disabled {
      opacity:.6;
      cursor:wait;
      box-shadow:none;
    }

    .status {
      font-size:12px;
      min-height:1.2em;
    }
    .status.ok { color:#059669; }
    .status.err { color:#b91c1c; }

    @media (max-width:860px){
      .card {
        grid-template-columns:1fr;
      }
      .left {
        border-right:none;
        border-bottom:1px solid #e5e7f0;
      }
      .calendar-layout {
        grid-template-columns:1fr;
      }
      .btn-primary {
        align-self:stretch;
        justify-content:center;
      }
      .tz-label{
        padding-top:0;
        white-space:normal;
        text-align:left;
      }
    }

    @media (max-width:540px){
      .page {
        padding:20px 10px;
      }
      .card {
        border-radius:0;
        box-shadow:none;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="card">
      <!-- LADO IZQUIERDO -->
      <div class="left">
        <div>
          <div class="host">Lukas Conejeros</div>
          <div class="title">Nueva reunión</div>
        </div>

        <div class="meta">
          <span class="icon-circle">⏱</span>
          <span>1 hr • Sesión AI Full System</span>
        </div>

        <p class="desc">
          Usa este enlace para agendar la sesión de diagnóstico.
          Selecciona el día y uno de los horarios disponibles.
          Una vez reservada la hora, recibirás el enlace a la videollamada.
        </p>

        <div class="left-footer">
          Tu horario se confirmará por WhatsApp / correo una vez recibamos la reserva.
        </div>
      </div>

      <!-- LADO DERECHO -->
      <div class="right">
        <div class="right-header">
          <div>
            <h2>Seleccione una fecha y hora</h2>

            <div class="field">
              <label for="nameInput">Tu nombre</label>
              <input id="nameInput" type="text" placeholder="Nombre y apellido" autocomplete="name" />
            </div>
          </div>

          <div class="tz-label" id="tzLabel"></div>
        </div>

        <div class="calendar-layout">
          <!-- Calendario -->
          <div class="calendar">
            <div class="cal-header">
              <button class="nav-btn" id="prevMonthBtn" aria-label="Mes anterior">&lt;</button>
              <div class="month-label" id="monthLabel">Mes Año</div>
              <button class="nav-btn" id="nextMonthBtn" aria-label="Mes siguiente">&gt;</button>
            </div>

            <div class="weekday-row">
              <div class="weekday">DOM</div>
              <div class="weekday">LUN</div>
              <div class="weekday">MAR</div>
              <div class="weekday">MIÉ</div>
              <div class="weekday">JUE</div>
              <div class="weekday">VIE</div>
              <div class="weekday">SÁB</div>
            </div>

            <div class="days-grid" id="daysGrid"></div>
          </div>

          <!-- Horarios -->
          <div class="slots-card">
            <div class="slots-title">Horarios disponibles</div>
            <div class="selected-date-label" id="selectedDateLabel">
              Selecciona un día del calendario.
            </div>

            <div class="slot-list" id="slotList">
              <!-- Se rellenan por JS -->
            </div>

            <div class="confirm-area">
              <button class="btn-primary" id="confirmBtn" type="button">
                <span>✔</span> Confirmar reunión
              </button>
              <div class="status" id="status"></div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    (function() {
      const webhookUrl = "https://flujos-pruebas-n8n.bvil2a.easypanel.host/webhook/78654118-6461-42c0-85cf-829fafcd3184";

      // si en el link vienen datos del contacto, los mandamos ocultos
      const params = new URLSearchParams(window.location.search);
      const contactData = {
        nombre: params.get("nombre") || "",
        whatsapp: params.get("whatsapp") || "",
        email: params.get("email") || ""
      };

      const monthLabel = document.getElementById("monthLabel");
      const daysGrid = document.getElementById("daysGrid");
      const prevBtn = document.getElementById("prevMonthBtn");
      const nextBtn = document.getElementById("nextMonthBtn");
      const tzLabel = document.getElementById("tzLabel");
      const slotList = document.getElementById("slotList");
      const selectedDateLabel = document.getElementById("selectedDateLabel");
      const confirmBtn = document.getElementById("confirmBtn");
      const statusEl = document.getElementById("status");

      // NUEVO: input nombre
      const nameInput = document.getElementById("nameInput");
      nameInput.value = contactData.nombre || "";

      const workingSlots = ["10:00", "11:00", "16:00"]; // 1 hr cada una

      const today = new Date();
      today.setHours(0,0,0,0);
      const maxDate = new Date(today);
      maxDate.setDate(maxDate.getDate() + 60); // 2 meses hacia adelante

      let currentMonth = today.getMonth();
      let currentYear = today.getFullYear();

      let selectedDate = null; // Date
      let selectedSlot = null; // string "HH:MM"

      // zona horaria
      try {
        const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || "";
        const now = new Date();
        const timeStr = now.toLocaleTimeString("es-CL", { hour:"2-digit", minute:"2-digit" });
        tzLabel.textContent = `Hora local (${timeStr}) • Zona: ${tz}`;
      } catch(e) {
        tzLabel.textContent = "Hora local";
      }

      function pad(n){ return n < 10 ? "0"+n : ""+n; }
      function toISODate(d){
        return d.getFullYear()+"-"+pad(d.getMonth()+1)+"-"+pad(d.getDate());
      }
      function humanDate(d){
        const fmt = new Intl.DateTimeFormat("es-CL", {
          weekday:"long",
          day:"numeric",
          month:"long",
          year:"numeric"
        });
        return fmt.format(d);
      }

      function isBeforeToday(d){
        return d.getTime() < today.getTime();
      }
      function isAfterMax(d){
        return d.getTime() > maxDate.getTime();
      }
      function isWeekend(d){
  const day = d.getDay(); // 0 domingo, 6 sábado
  return day === 0; // solo domingo
}

      function renderCalendar(){
        const firstOfMonth = new Date(currentYear, currentMonth, 1);
        const lastOfMonth = new Date(currentYear, currentMonth + 1, 0);

        const monthName = firstOfMonth.toLocaleString("es-CL", { month:"long" });
        monthLabel.textContent = monthName.charAt(0).toUpperCase() + monthName.slice(1) + " " + currentYear;

        daysGrid.innerHTML = "";

        const startDay = firstOfMonth.getDay(); // 0 dom ... 6 sab
        const daysInMonth = lastOfMonth.getDate();

        // celdas vacías antes del 1
        for(let i=0;i<startDay;i++){
          const empty = document.createElement("div");
          daysGrid.appendChild(empty);
        }

        const selectedISO = selectedDate ? toISODate(selectedDate) : null;

        for(let day=1; day <= daysInMonth; day++){
          const dateObj = new Date(currentYear, currentMonth, day);
          dateObj.setHours(0,0,0,0);
          const iso = toISODate(dateObj);

          const btn = document.createElement("button");
          btn.type = "button";
          btn.className = "day";
          btn.innerHTML = "<span>"+day+"</span>";

          if(iso === toISODate(today)){
            btn.classList.add("today");
          }

          const disabled = isBeforeToday(dateObj) || isAfterMax(dateObj) || isWeekend(dateObj);
          if(disabled){
            btn.classList.add("disabled");
          }else{
            btn.addEventListener("click", () => {
              selectedDate = dateObj;
              selectedSlot = null;
              updateSelectedDateUI();
              renderSlots();
            });
          }

          if(selectedISO && iso === selectedISO){
            btn.classList.add("selected");
          }

          daysGrid.appendChild(btn);
        }

        // limitar navegación
        const minMonth = today.getMonth();
        const minYear = today.getFullYear();
        const maxMonth = maxDate.getMonth();
        const maxYear = maxDate.getFullYear();

        prevBtn.disabled = currentYear < minYear || (currentYear === minYear && currentMonth <= minMonth);
        nextBtn.disabled = currentYear > maxYear || (currentYear === maxYear && currentMonth >= maxMonth);
      }

      function updateSelectedDateUI(){
        const iso = selectedDate ? toISODate(selectedDate) : null;
        const dayButtons = daysGrid.querySelectorAll(".day");
        dayButtons.forEach(btn => {
          btn.classList.remove("selected");
          const text = btn.textContent.trim();
          if(!iso || !text) return;
          const d = new Date(currentYear, currentMonth, parseInt(text,10));
          d.setHours(0,0,0,0);
          if(toISODate(d) === iso){
            btn.classList.add("selected");
          }
        });

        if(selectedDate){
          const h = humanDate(selectedDate);
          selectedDateLabel.textContent = h.charAt(0).toUpperCase() + h.slice(1);
        }else{
          selectedDateLabel.textContent = "Selecciona un día del calendario.";
        }
      }

      function renderSlots(){
        slotList.innerHTML = "";

        if(!selectedDate){
          workingSlots.forEach(time => {
            const btn = document.createElement("button");
            btn.type = "button";
            btn.className = "slot-btn";
            btn.textContent = time;
            btn.disabled = true;
            slotList.appendChild(btn);
          });
          return;
        }

        workingSlots.forEach(time => {
          const btn = document.createElement("button");
          btn.type = "button";
          btn.className = "slot-btn";
          btn.textContent = time;
          if(selectedSlot === time){
            btn.classList.add("selected");
          }
          btn.addEventListener("click", () => {
            selectedSlot = time;
            slotList.querySelectorAll(".slot-btn").forEach(b => b.classList.remove("selected"));
            btn.classList.add("selected");
            statusEl.textContent = "";
            statusEl.className = "status";
          });
          slotList.appendChild(btn);
        });
      }

      prevBtn.addEventListener("click", () => {
        if(prevBtn.disabled) return;
        currentMonth--;
        if(currentMonth < 0){
          currentMonth = 11;
          currentYear--;
        }
        renderCalendar();
        updateSelectedDateUI();
        renderSlots();
      });

      nextBtn.addEventListener("click", () => {
        if(nextBtn.disabled) return;
        currentMonth++;
        if(currentMonth > 11){
          currentMonth = 0;
          currentYear++;
        }
        renderCalendar();
        updateSelectedDateUI();
        renderSlots();
      });

      async function confirm(){
        statusEl.textContent = "";
        statusEl.className = "status";

        if(!selectedDate || !selectedSlot){
          statusEl.textContent = "Elige un día y un horario antes de confirmar.";
          statusEl.classList.add("err");
          return;
        }

        confirmBtn.disabled = true;
        confirmBtn.textContent = "Enviando...";

        const nombreFinal = (nameInput.value || "").trim() || contactData.nombre || "";

        const payload = {
          fecha: toISODate(selectedDate),
          hora: selectedSlot,
          duracion_min: 60,
          canal: "AI Full System",
          origen: "agenda_html_calendly_like",
          nombre: nombreFinal,
          whatsapp: contactData.whatsapp,
          email: contactData.email
        };

        try {
          const res = await fetch(webhookUrl, {
            method:"POST",
            headers:{ "Content-Type":"application/json" },
            body: JSON.stringify(payload)
          });

          if(res.ok){
            statusEl.textContent = "Listo, tu reunión quedó registrada. Te enviaremos la confirmación.";
            statusEl.classList.add("ok");
          }else{
            statusEl.textContent = "Hubo un problema al registrar la reunión. Inténtalo nuevamente.";
            statusEl.classList.add("err");
          }
        } catch (e) {
          console.error(e);
          statusEl.textContent = "No pudimos conectar con el servidor. Revisa tu conexión e inténtalo otra vez.";
          statusEl.classList.add("err");
        } finally {
          confirmBtn.disabled = false;
          confirmBtn.textContent = "Confirmar reunión";
        }
      }

      confirmBtn.addEventListener("click", confirm);

      // init
      renderCalendar();
      renderSlots();
    })();
  </script>
</body>
</html>



